<div class="pos">

  <div flash-alert active-class="in" class="alert fade">
    <strong class="alert-heading"></strong>
    <alert ng-show="flash.message" type="flash.type || success">{{flash.message}}</alert>
  </div>


  <wizard>

    <wz-step title="Location">
      <h2>Pick a location:</h2>
      <button class="tiny" ng-click="getLocations()">Refresh</button>

      <table>
        <thead>
        <th>id</th>
        <th>name</th>
        <th>address</th>
        <th></th>
        </thead>
        <tbody>
        <tr ng-repeat="location in locations">
          <td>{{location.id}}</td>
          <td>{{location.name}}</td>
          <td>
            {{location.address_line1}} <br/>
            {{location.city}} <br/>
            {{location.state}} <br/>
          </td>
          <td>
            <button class="tiny" ng-click="selectLocationAndGo(location.id)">
              Select
            </button>
          </td>
        </tr>
        </tbody>
      </table>
    </wz-step>

    <wz-step title="Integration type">

      <tabset>
        <tab heading="Pay@Table" select="selectTab('pay-at-table')">
          <h2>Pay@Table:</h2>

          <div>
            Enter a table name with some orders on it
          </div>

          <input type="text" ng-model="selectedTable.name"/>

          <button class="tiny" ng-click="fetchTableAndGo()">
            Fetch table
          </button>
        </tab>
        <tab heading="Order Ahead" select="selectTab('order-ahead')">
          <h2>Order Ahead</h2>

          <div>
            Create a new order for location: {{location.id}}
          </div>
            <br/>
            <div>
                <div>
                    Order Type:
                    <div class="pickup">
                        <label>
                            <input type="radio" name="orderOfType" value="pickup" ng-model="orderType" ng-change='setOrderType("pickup")'>
                            Pickup
                        </label>
                    </div>
                    <div class="delivery">
                        <label>
                            <input type="radio" name="orderOfType" value="delivery" ng-model="orderType" ng-change='setOrderType("delivery")'>
                            Delivery
                        </label>
                    </div>
                </div>
                Item Pos Id:
                <input type="text" name="itemPosId" ng-model="itemPosId" ng-change="setPosId({{'itemPosId'}})">
                Item Price:
                <input type="text" name="itemPrice" ng-model="itemPrice" ng-change="setItemPrice({{'itemPrice'}})">
                <div>
                    Include Varient
                    <input type="checkbox" ng-model="includeVarient" mg-model="includeVarient" ng-change="setIncludeVarient({{'includeVarient'}})" />
                </div>
                Varient Pos Id:
                <input type="text" name="varientPosId" ng-model="varientId" ng-change="setVarientId({{'varientPosId'}})">
                Varient Price:
                <input type="text" name="varientPrice" ng-model="varientPrice" ng-change="setVarientPrice({{'varientPrice'}})">
                <div>
                    Include Order surcount
                    <input type="checkbox" ng-model="includeOrderSurcount" mg-model="includeOrderSurcount" ng-change="setIncludeOrderSurcount({{'includeOrderSurcount'}})" />
                </div>
                Order surcount Pos Id:
                <input type="text" name="orderSurcountPosId" ng-model="orderSurcountPosId" ng-change="setOrderSurcountPosId({{'orderSurcountPosId'}})">
                Order Surcount Price:
                <input type="text" name="orderSurcountPrice" ng-model="orderSurcountPrice" ng-change="setOrderSurcountPrice({{'orderSurcountPrice'}})">
                <div>
                    Include Item surcount
                    <input type="checkbox" ng-model="includeItemSurcount" mg-model="includeOrderSurcount" ng-change="setIncludeItemSurcount({{'includeItemSurcount'}})" />
                </div>
                Item surcount Pos Id:
                <input type="text" name="itemSurcountPosId" ng-model="itemSurcountPosId" ng-change="setItemSurcountPosId({{'itemSurcountPosId'}})">
                Item Surcount Price:
                <input type="text" name="itemSurcountPrice" ng-model="itemSurcountPrice" ng-change="setItemSurcountPrice({{'itemSurcountPrice'}})">
                <div>
                    Include Transaction
                    <input type="checkbox" ng-model="includeTransaction" mg-model="includeTransaction" ng-change="setIncludeTransaction({{'includeTransaction'}})" />
                </div>
            </div>
          <pre class="code-block"><code>{{formattedOrder()}}</code></pre>
            
            <div>
                <button class="tiny" ng-click="makeDelivery()">
                    Delivery
                </button>
                <button class="tiny" ng-click="makePickup()">
                    Pickup
                </button>
                <button class="tiny" ng-click="addSurcount()">
                    Surcount
                </button>
                <button class="tiny" ng-click="addOptions()">
                    Options
                </button>
            </div>
            <button class="tiny" ng-click="sendOrderAndGo()">
                Send Order
            </button>

    </tab>
      </tabset>

    </wz-step>

    <wz-step title="Table Orders" wz-disabled="{{ selectedTab === 'order-ahead' }}">
      <h2>Orders for table "{{ selectedTable.name }}":</h2>

      <table>
        <thead>
        <th>order Id</th>
        <th>checkin id</th>
        <th>status</th>
        <th>version</th>
        <th>actions</th>
        </thead>
        <tbody>
        <tr ng-repeat="order in tableOrders">
          <td>{{ order.id }}</td>
          <td>{{ order.checkinId }}</td>
          <td>{{ order.status }}</td>
          <td>{{ order.version }}</td>
          <td>
            <button class="tiny" ng-click="getOrderAndGo(order.id)">Get Order</button>
          </td>
        </tr>
        </tbody>
      </table>
    </wz-step>
    <wz-step title="Order Details" wz-disabled="{{ selectedTab === 'order-ahead' }}">
      <h2>Details for order "{{ order.id }}":</h2>

      <div><b>id:</b> {{ order.id }}</div>
      <div><b>status:</b> {{ order.status }}</div>
      <div><b>version:</b> {{ order.version }}</div>
      <div><b>uri:</b> {{ order.uri }}</div>
      <div>
        <b>items:</b> <br/>

        <table>
          <thead>
            <th>posId</th>
            <th>name</th>
            <th>description</th>
            <th>price</th>
            <th>quantity</th>
          </thead>
          <tbody>
            <tr ng-repeat="item in order.items">
              <td>{{ item.posId }}</td>
              <td>{{ item.name }}</td>
              <td>{{ item.description }}</td>
              <td>{{ item.price }}</td>
              <td>{{ item.quantity }}</td>
            </tr>
          </tbody>
        </table>
      </div>

      <p ng-show="order.status !== 'accepted'">You cannot pay for an order that hasn't been accepted.</p>

      <button class="tiny" ng-click="addPayments()" ng-disabled="order.status !== 'accepted'">Add Payments</button>
    </wz-step>
    <wz-step title="Transaction" wz-disabled="{{ selectedTab === 'order-ahead' }}">
      <h2>Details for transaction "{{ Meerkat.data.pendingTransactions[0].id }}":</h2>

      <div ng-if="Meerkat.data.pendingTransactions[0].status !== 'waiting'">
        The order is ready to pay, you'll be able to continue when the POS is waiting for payment.

        <br/>
        <br/>

        <img src="images/loader.gif" width="200px" height="200px"/>
      </div>


      <div ng-if="Meerkat.data.pendingTransactions[0].status === 'waiting'">
        The transaction is now waiting for payment. Click "Pay" to complete the transaction.
        <button class="tiny" ng-click="complete()">Pay</button>
      </div>

      <div ng-if="Meerkat.data.pendingTransactions[0].status === 'rejected'">
        The POS has rejected the transaction.
        <a class="button small" wz-next>Next</a>
      </div>
    </wz-step>



    <wz-step title="Consumer" wz-disabled="{{ selectedTab === 'pay-at-table' }}">

      <a class="button small" wz-next>Next</a>
    </wz-step>

    <wz-step title="Transactions" wz-disabled="{{ selectedTab === 'pay-at-table' }}">

      <a class="button small" wz-next>Next</a>
    </wz-step>

    <wz-step title="Done">
      You're done! You can start over by pressing "Go home".
      <a class="button small" ng-click="startOver()">Go home</a>
    </wz-step>

  </wizard>

</div>
